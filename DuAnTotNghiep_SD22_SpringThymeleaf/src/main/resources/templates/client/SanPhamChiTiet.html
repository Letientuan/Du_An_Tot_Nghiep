<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>ShoeSee - Online Store</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="TemplatesJungle">
    <meta name="keywords" content="Online Store">
    <meta name="description" content="Stylish - Shoes Online Store HTML Template">

    <link rel="stylesheet" th:href="@{/assets/css/vendor.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chocolat@0.7.0/dist/css/chocolat.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,900;1,900&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"
          rel="stylesheet">

    <style>
        #products-list {
            display: flex;
            flex-wrap: wrap;
        }

        .selected-image {
            border: 2px solid #00f; /* Viền xanh dương */
            box-sizing: border-box; /* Đảm bảo kích thước hình ảnh không bị thay đổi */
        }

        .product-container {
            flex: 1;
            padding: 10px;
        }

        .product-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-sizing: border-box;
        }

        .product-info img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .additional-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .additional-images img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
        }

        .size-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }


        .size-container p {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f9f9f9;
            text-align: center;
        }

        .size-container p:hover {
            background-color: #e0e0e0;
        }

        .size-container .selected-size {
            border: 2px solid #00f; /* Viền xanh dương khi được chọn */
            background-color: #e0e0e0; /* Thay đổi nền khi được chọn */
        }


        @media (max-width: 767px) {
            #products-list {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
<div th:replace="~{client/fragmentsClient/header :: header}"></div>

<section id="latest-products" class="product-store py-2 my-2 py-md-5 my-md-5 pt-0">
    <div class="container-md">
        <div class="heading_container heading_center" style="margin-bottom: 30px;">
            <div style="display: flex; align-items: center; justify-content: center; width: 100%; background-color: #E8E8E8;">
                <div style="width: 12%; height: 3px; background-color: #FF8C00;"></div>
            </div>
        </div>

        <div class="row d-flex" id="products-list">
            <div class=" d-flex">
                <div id="anh" class="col-md-8"></div>
                <div class="col-md-4">
                    <div class="col-md-12 ">
                        <div id="ten"></div>
                        <div class="d-flex">
                            <p style=" margin-right: 5px ">Giá :</p>
                            <div id="gia"></div>
                        </div>
                    </div>
                    <div>
                        <p>Chọn Màu :</p>
                        <div id="mau" class="col-md-12"></div>

                        <p>Chọn Size :</p>
                        <div id="size" class="col-md-12"></div>
                    </div>

                    <div id="sl" class="col-md-12 d-flex">
                        <div class="d-flex md-8">
                            <button class="btn btn-light" onclick="decrease()">-</button>
                            <input class="text-center btn btn-light" type="text" id="quantity" value="1" min="1"
                                   style="width: 50px">
                            <button class="btn btn-light" onclick="increase()">+</button>
                        </div>
                        <div id="soluongton" class="md-4" style="margin-top:5px  "></div>
                    </div>
                    <br>
                    <div id="mua">
                        <button class="btn btn-danger" id="muangay">Mua Ngay</button>
                        <button class="btn btn-outline-warning" id="themgiohang">Thêm Giỏ Hàng</button>
                    </div>

                </div>
            </div><!-- Added div for additional images -->
        </div>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/jarallax@1.12.0/dist/jarallax.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jarallax@1.12.0/dist/jarallax-video.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function increase() {
        let quantity = document.getElementById('quantity');
        quantity.value = parseInt(quantity.value) + 1;
    }

    function decrease() {
        let quantity = document.getElementById('quantity');
        if (quantity.value > 1) {
            quantity.value = parseInt(quantity.value) - 1;
        }
    }

</script>
<script>
    $(document).ready(function () {
        const path = window.location.pathname;
        const pathParts = path.split('/');
        const sanPhamId = pathParts[pathParts.length - 1];
        let slconlai ;


        if (!sanPhamId) {
            console.error('Không tìm thấy ID sản phẩm trong URL.');
            $('#products-list').append('<p>Không có ID sản phẩm.</p>');
            return;
        }


        $.ajax({
            url: `/sanphamchitietclien/${sanPhamId}`,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                console.log('Dữ liệu sản phẩm chính:', data);

                const productsContainer = $('#mau');
                const anhsp = $('#anh');
                const sizesp = $('#size');

                const ten = $('#ten');
                const gia = $('#gia');
                const sltonsp = $('#soluongton');
                productsContainer.empty();

                if (data && typeof data === 'object' && data.id) {
                    const productName = data.ten || 'Không có tên';
                    const productPrice = data.giaBan != null ? data.giaBan.toLocaleString('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }) : 'Không có giá';
                    const productImage = data.anh ? `https://res.cloudinary.com/deapopcoc/image/upload/${data.anh}` : 'path/to/default-image.jpg';


                    const mainImage = $(`
                    <img src="${productImage}" alt="Product Image" style="width: 700px; height: 700px; border-radius: 8px;">
                `);
                    const tensp = $(`

                            <h1 class="card-title" style="color: #333; margin-top: 10px;">${productName}</h1>

                `);
                    const giasp = $(`

                            <p class="product-price" style="font-size: 17px; color: #d9534f; margin-bottom: 10px;">${productPrice}</p>

                `);


                    anhsp.append(mainImage);
                    ten.append(tensp);
                    gia.append(giasp);


                    const additionalImagesDiv = $('<div class="additional-images"></div>');


                    $.ajax({
                        url: `/sanphamchitietclientanh/${data.sanPham.id}`,
                        method: 'GET',
                        dataType: 'json',
                        success: function (additionalData) {
                            console.log('Dữ liệu bổ sung nhận được:', additionalData); // Debug output
                            const additionalImages = additionalData || [];

                            additionalImages.forEach(img => {
                                const imageName = img;

                                const additionalImageDiv = $(`
                                <div>
                                    <img src="https://res.cloudinary.com/deapopcoc/image/upload/${img}" alt="Additional Product Image" data-name="${imageName}">
                                </div>
                            `);
                                additionalImagesDiv.append(additionalImageDiv);
                            });


                            productsContainer.append(additionalImagesDiv);


                            $('.additional-images img').on('click', function () {

                                $('.additional-images img').removeClass('selected-image');


                                $(this).addClass('selected-image');
                                document.getElementById('themgiohang').addEventListener('click', function() {
                                    $.ajax({
                                        url: '/api/session/user',
                                        method: 'GET',
                                        success: function (response) {
                                            let idKhachHang = response.id;
                                            let selectedSize = null
                                            if (selectedSize === null || selectedSize === undefined ||
                                                imageName === null || imageName === undefined ||
                                                idKhachHang === null || idKhachHang === undefined) {
                                            } else {
                                                console.log("đã oke" + selectedSize + ", imge" + imageName + " id kh" + idKhachHang);
                                            }
                                        },
                                        error: function (xhr, status, error) {
                                            window.location.href = `/login`;
                                        }
                                    });
                                });
                                const imageName = $(this).data('name');
                                console.log('Tên hình ảnh:', imageName);
                                const sizemau = "";
                                gia.empty();
                                anhsp.empty();
                                const mainImage = $(`
                    <img src="https://res.cloudinary.com/deapopcoc/image/upload/${imageName}" alt="Product Image" style="width: 700px; height: 700px; border-radius: 8px;">
                `);
                                anhsp.append(mainImage);

                                $('.size-container').remove();

                                $.ajax({
                                    url: `/kichco/${data.sanPham.id}/${imageName}`,
                                    method: 'GET',
                                    dataType: 'json',
                                    success: function (sizes) {
                                        console.log('Sizes:', sizes); // Debug output
                                        const sizegia = sizes[0];
                                        $.ajax({
                                            url: `/gia-ban/${data.sanPham.id}/${sizegia}/${imageName}`,
                                            method: 'GET',
                                            dataType: 'json',
                                            success: function (giaanh) {
                                                const giakhichonanh = giaanh != null ? giaanh.toLocaleString('vi-VN', {
                                                    style: 'currency',
                                                    currency: 'VND'
                                                }) : 'Không có giá';
                                                const giaspanh = $(`

                                                          <p class="product-price" style="font-size: 17px; color: #d9534f; margin-bottom: 10px;">${giakhichonanh}</p>

                                                             `);
                                                gia.append(giaspanh);
                                            },
                                            error: function (xhr, status, error) {
                                                console.error('Lỗi khi lấy dữ liệu kích cỡ:', error);
                                            }
                                        });

                                        const sizeDiv = $('<div class="size-container"></div>');
                                        sizes.forEach(size => {
                                            const sizeElement = $(`

                                            <p>${size}</p>
                                        `);
                                            sizeDiv.append(sizeElement);
                                        });


                                        sizesp.append(sizeDiv);
                                        $('.size-container p').on('click', function () {
                                            $('.size-container p').removeClass('selected-size');
                                            $(this).addClass('selected-size');

                                            // Hiển thị tên kích cỡ được chọn
                                            const selectedSize = $(this).text();
                                            console.log('Kích cỡ được chọn v:', selectedSize);
                                            sltonsp.empty();
                                            gia.empty();

                                            $.ajax({
                                                url: `/gia-ban/${data.sanPham.id}/${selectedSize}/${imageName}`,
                                                method: 'GET',
                                                dataType: 'json',
                                                success: function (giaban) {
                                                    console.log('giasize:', giaban);
                                                    const giakhichonsize = giaban != null ? giaban.toLocaleString('vi-VN', {
                                                        style: 'currency',
                                                        currency: 'VND'
                                                    }) : 'Không có giá';
                                                    const giaspsize = $(`

                                                          <p class="product-price" style="font-size: 17px; color: #d9534f; margin-bottom: 10px;">${giakhichonsize}</p>

                                                             `);
                                                    gia.append(giaspsize);
                                                },
                                                error: function (xhr, status, error) {
                                                    console.error('Lỗi khi lấy dữ liệu kích cỡ:', error);
                                                }
                                            });
                                            $.ajax({
                                                url: `/SLton/${data.sanPham.id}/${imageName}/${selectedSize}`,
                                                method: 'GET',
                                                dataType: 'json',
                                                success: function (sl) {
                                                    console.log('số lượng tồn:', sl);
                                                    slconlai = sl
                                                    console.log("hmmmm"+slconlai);
                                                    const slton = $(`
                                                                    <div>
                                                                          <p class="product-price" style="font-size: 17px; color: #000000; margin-bottom: 10px; opacity: 0.5;margin-left: 10px">
                                                                           ${sl + ' sản phẩm có sẵn'}
                                                                          </p>

                                                                     </div>
                                                                  `);
                                                    sltonsp.append(slton);
                                                    document.getElementById('themgiohang').addEventListener('click', function() {
                                                        $.ajax({
                                                            url: '/api/session/user',
                                                            method: 'GET',
                                                            success: function (response) {
                                                                $.ajax({
                                                                    url: '/api/session/user',
                                                                    method: 'GET',
                                                                    success: function (response) {
                                                                        let idKhachHang = response.id;

                                                                        var inputElement = document.getElementById('quantity');

                                                                        var soluongspkhithem = inputElement.value;
                                                                        $.ajax({
                                                                            url: `/detailcheckgh/${idKhachHang}/${imageName}/${selectedSize}/${data.sanPham.id}/${soluongspkhithem}`,
                                                                            type: 'GET',
                                                                            success: function(response) {

                                                                                console.log('Response:', response);


                                                                            },
                                                                            error: function(xhr, status, error) {
                                                                                // Xử lý lỗi
                                                                                console.error('Error:', error);
                                                                            }
                                                                        });
                                                                    },
                                                                    error: function (xhr, status, error) {
                                                                        window.location.href = `/login`;
                                                                    }
                                                                });
                                                            },
                                                            error: function (xhr, status, error) {
                                                                window.location.href = `/login`;
                                                            }
                                                        });

                                                    });
                                                },
                                                error: function (xhr, status, error) {
                                                    console.error('Lỗi khi lấy dữ liệu kích cỡ:', error);
                                                }
                                            });
                                        });
                                    },
                                    error: function (xhr, status, error) {
                                        console.error('Lỗi khi lấy dữ liệu kích cỡ:', error);
                                    }
                                });
                            });
                        },
                        error: function (xhr, status, error) {
                            console.error('Lỗi khi lấy dữ liệu bổ sung:', error);
                        }
                    });
                    $.ajax({
                        url: `/kichco/${data.sanPham.id}/${data.anh}`,
                        method: 'GET',
                        dataType: 'json',
                        success: function (sizes) {
                            console.log('Sizes:', sizes); // Debug output


                            const sizeDiv = $('<div class="size-container"></div>');
                            sizes.forEach(size => {
                                const sizeElement = $(`
                                            <p>${size}</p>
                                        `);
                                sizeDiv.append(sizeElement);
                            });


                            sizesp.append(sizeDiv);


                            $('.size-container p').on('click', function () {
                                // Loại bỏ lớp 'selected-size' từ tất cả các kích cỡ
                                $('.size-container p').removeClass('selected-size');

                                // Thêm lớp 'selected-size' vào kích cỡ được click
                                $(this).addClass('selected-size');

                                // Hiển thị tên kích cỡ được chọn
                                const selectedSize = $(this).text();
                                console.log('Kích cỡ được chọn v:', selectedSize);
                                document.getElementById('themgiohang').addEventListener('click', function() {
                                    $.ajax({
                                        url: '/api/session/user',
                                        method: 'GET',
                                        success: function (response) {
                                            let idKhachHang = response.id;
                                            let abc = null;

                                        },
                                        error: function (xhr, status, error) {
                                            window.location.href = `/login`;
                                        }
                                    });

                                });
                            });
                        },
                        error: function (xhr, status, error) {
                            console.error('Lỗi khi lấy dữ liệu kích cỡ:', error);
                        }
                    });
                } else {
                    productsContainer.append('<p>Không có dữ liệu sản phẩm.</p>');
                }
            },
            error: function (xhr, status, error) {
                console.error('Lỗi khi lấy dữ liệu:', error);
                $('#products-list').append('<p>Đã xảy ra lỗi khi lấy dữ liệu sản phẩm.</p>');
            }
        });
    });


</script>

<script src="https://cdn.jsdelivr.net/npm/chocolat@0.7.0/dist/js/chocolat.min.js"></script>
<script th:src="@{/assets/js/plugins.js}"></script>
<script th:src="@{/assets/js/client.js}"></script>
<script th:src="@{/assets/js/script.js}"></script>

<div th:replace="~{client/fragmentsClient/footer :: footer}"></div>
</body>

</html>
