<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="~{admin/fragments/head :: head}"></div>
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
        }

        .notification.show1 {
            display: block;
            animation: fadeOut 3s ease-out forwards;
        }

        .progress-bar1 {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #fff;
            transition: width 3s linear;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }

        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>

<body>
<div class="container-xxl position-relative bg-white d-flex p-0">
    <div th:replace="~{admin/fragments/sidebar :: sidebar}"></div>

    <div class="content">
        <nav th:replace="~{admin/fragments/navbar :: nav}"></nav>
        <div class="container d-flex justify-content-center align-items-center vh-100">
            <div class="container mt-5">
                <div class="text-center">
                    <span class="col-md-11 fw-bold fs-3 text-center">Thêm mới địa chỉ</span>
                </div>
                <form id="myForm" th:action="@{dia-chi-add}" method="post" class="row g-3" th:object="${dc}">
                    <input type="hidden" name="thanhPho" th:value="*{thanhPho}">
                    <input type="hidden" name="quanHuyen" th:value="*{quanHuyen}">
                    <input type="hidden" name="phuongXa" th:value="*{phuongXa}">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Tên Người Nhận:</label>
                            <input type="text" placeholder="Nhập tên người nhận" id="ten" name="ten"
                                   class="form-control" th:field="*{ten}" oninput="validateForm()">
                            <div id="tenError" class="error"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tỉnh/Thành Phố</label>
                            <select class="form-select form-select-sm mb-3" id="city" aria-label="Chọn tỉnh thành"
                                    th:field="*{thanhPho}" oninput="validateForm()">
                                <option value="" selected>Chọn tỉnh thành</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quận/Huyện</label>
                            <select class="form-select form-select-sm mb-3" id="district" aria-label="Chọn quận huyện"
                                    th:field="*{quanHuyen}" oninput="validateForm()">
                                <option value="" selected>Chọn quận huyện</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phường/Xã</label>
                            <select class="form-select form-select-sm mb-3" id="ward" aria-label="Chọn phường xã"
                                    th:field="*{phuongXa}" oninput="validateForm()">
                                <option value="" selected>Chọn phường xã</option>
                            </select>
                        </div>
                        <span id="dcError" class="error"></span>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Số Nhà:</label>
                            <textarea class="form-control" id="diachict" name="sonha" rows="3" th:field="*{soNha}"
                                      oninput="validateForm()"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Mô Tả:</label>
                            <textarea class="form-control" id="mota" name="mota" rows="3" th:field="*{moTaChiTiet}"
                                      oninput="validateForm()"></textarea>
                        </div>
                    </div>
                    <div class="text-center">
                        <a th:href="@{/admin/khach-hang}" class="btn btn-secondary">Đóng</a>
                        <button type="submit" class="btn btn-primary" id="confirmButton">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="@{/assets/js/main.js}"></script>
    <script>
        var citis = document.getElementById("city");
        var districts = document.getElementById("district");
        var wards = document.getElementById("ward");
        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "json", // Chỉnh responseType thành json để nhận dữ liệu JSON trực tiếp
        };

        // Gửi request lấy dữ liệu
        axios(Parameter).then(function (response) {
            renderCity(response.data); // Gọi hàm renderCity khi có dữ liệu trả về
        }).catch(function (error) {
            console.error('Error fetching data: ', error);
        });

        function renderCity(data) {
            // Hàm để render danh sách các tỉnh/thành phố vào dropdown citis
            data.forEach(function (city) {
                citis.options[citis.options.length] = new Option(city.Name, city.Id);
            });

            // Sự kiện khi chọn tỉnh/thành phố
            citis.onchange = function () {
                clearOptions(districts); // Xóa các option cũ của districts
                clearOptions(wards); // Xóa các option cũ của wards

                // Lọc ra thông tin của tỉnh/thành phố được chọn
                var selectedCity = data.find(function (city) {
                    return city.Id === citis.value;
                });

                if (selectedCity) {
                    // Render các quận/huyện vào dropdown districts
                    selectedCity.Districts.forEach(function (district) {
                        districts.options[districts.options.length] = new Option(district.Name, district.Id);
                    });
                }

                // Cập nhật các trường ẩn
                updateHiddenFields();
            };

            // Sự kiện khi chọn quận/huyện
            districts.onchange = function () {
                clearOptions(wards); // Xóa các option cũ của wards

                // Lấy thông tin của tỉnh/thành phố được chọn
                var selectedCity = data.find(function (city) {
                    return city.Id === citis.value;
                });

                if (selectedCity) {
                    // Lọc ra thông tin của quận/huyện được chọn
                    var selectedDistrict = selectedCity.Districts.find(function (district) {
                        return district.Id === districts.value;
                    });

                    if (selectedDistrict) {
                        // Render các phường/xã vào dropdown wards
                        selectedDistrict.Wards.forEach(function (ward) {
                            wards.options[wards.options.length] = new Option(ward.Name, ward.Id);
                        });
                    }
                }

                // Cập nhật các trường ẩn
                updateHiddenFields();
            };

            // Sự kiện khi chọn phường/xã
            wards.onchange = function () {
                // Lấy thông tin của tỉnh/thành phố được chọn
                var selectedCity = data.find(function (city) {
                    return city.Id === citis.value;
                });

                if (selectedCity) {
                    // Lọc ra thông tin của quận/huyện được chọn
                    var selectedDistrict = selectedCity.Districts.find(function (district) {
                        return district.Id === districts.value;
                    });

                    if (selectedDistrict) {
                        var selectedWard = selectedDistrict.Wards.find(function (ward) {
                            return ward.Id === wards.value;
                        });

                        if (selectedWard) {
                            // Tạo chuỗi để log các thông tin
                            var logString = selectedWard.Name;
                            logString += "," + selectedDistrict.Name;
                            logString += "," + selectedCity.Name;

                            // Log chuỗi kết quả ra console
                            console.log(logString);

                            // Cập nhật giá trị của trường ẩn
                            updateHiddenFields();
                        }
                    }
                }
            };
        }

        function clearOptions(selectElement) {
            for (var i = selectElement.options.length - 1; i > 0; i--) {
                selectElement.remove(i);
            }
        }

        function updateHiddenFields() {
            // Cập nhật giá trị của các trường ẩn
            var selectedCity = citis.options[citis.selectedIndex];
            var selectedDistrict = districts.options[districts.selectedIndex];
            var selectedWard = wards.options[wards.selectedIndex];

            document.getElementsByName("thanhPho")[0].value = selectedCity ? selectedCity.value : "";
            document.getElementsByName("quanHuyen")[0].value = selectedDistrict ? selectedDistrict.value : "";
            document.getElementsByName("phuongXa")[0].value = selectedWard ? selectedWard.value : "";
        }

    </script>
</body>

</html>
