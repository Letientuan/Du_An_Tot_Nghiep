<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<div th:replace="~{admin/fragments/head :: head}"></div>
<link rel="icon" type="image/svg+xml"
      href="https://bizweb.dktcdn.net/100/048/601/themes/734017/assets/index-cate-icon-4.png?1610907247309"/>
<title> Quản lí Phiếu Giảm Giá</title>
<body>

<div class="container-xxl position-relative bg-white d-flex p-0">
    <!-- Spinner Start -->
    <div
            id="spinner"
            class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
    >
        <div
                class="spinner-border text-primary"
                style="width: 3rem; height: 3rem"
                role="status"
        >
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->
    <!-- Sidebar Start -->
    <div th:replace="~{admin/fragments/sidebar :: sidebar}"></div>
    <!-- Sidebar End -->
    <!-- Content Start -->
    <div class="content">
        <!-- Navbar Start -->
        <nav th:replace="~{admin/fragments/navbar :: nav}"></nav>
        <!-- Navbar End -->
        <div class="container mt-5">

            <form method="get" class="mt-3 mb-3" id="searchForm">
                <div class="input-group mb-3">
                    <input type="text" id="searchInput" name="keyword" class="form-control"
                           placeholder="Tìm kiếm phiếu giảm giá" oninput="OnSearchEmployee()">
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group row">
                            <label for="trangThai" class="col-sm-4 col-form-label">Trạng thái:</label>
                            <div class="col-sm-8">
                                <select id="trangThai" name="trangThai" class="form-control">
                                    <option value="">Tất cả</option>
                                    <option value="0">Hoạt động</option>
                                    <option value="1">Ngừng hoạt động</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group row">
                            <label for="hinhThucGiam" class="col-sm-4 col-form-label">Hình Thức Giảm:</label>
                            <div class="col-sm-8">
                                <select id="hinhThucGiam" name="hinhThucGiam" class="form-control">
                                    <option value="">Tất cả</option>
                                    <option value="0">Tiền mặt</option>
                                    <option value="1">% </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group row">
                            <label for="ngayBatDau" class="col-sm-5 col-form-label">Ngày Bắt Đầu:</label>
                            <div class="col-sm-7">
                                <input type="date" name="ngayBatDau" id="ngayBatDau">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group row">
                            <label for="ngayKetThuc" class="col-sm-5 col-form-label text-center">Ngày Kết Thúc:</label>
                            <div class="col-sm-7">
                                <input type="date" name="ngayKetThuc" id="ngayKetThuc">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group-append text-center">
                    <button type="button" class="btn btn-info" onclick="OnSearchEmployee()">Tìm kiếm</button>
                    <button type="button" class="btn btn-warning">Làm Mới </button>
                </div>
            </form>


            <h1 class="text-center mb-4 " style="font-size: 2em">Danh Sách Phiếu Giảm Giá</h1>
            <a th:href="@{/admin/addPhieuGiamGia}" class="btn btn-outline-danger">+ Thêm </a>
            <table class="table table-striped table-hover">
                <thead class="text-center">
                <tr>
                    <th scope="col">STT</th>
                    <th scope="col">Mã</th>
                    <th scope="col">Số Lượng</th>
                    <th scope="col">Hình Thức Giảm</th>
                    <th scope="col">Đơn Tối Thiểu</th>
                    <th scope="col">Giá Trị Giảm</th>
                    <th scope="col">Giảm Tối Đa</th>
                    <th scope="col">Ngày Bắt Đầu</th>
                    <th scope="col">Ngày Kết Thúc</th>
                    <th scope="col">Trạng Thái</th>
                    <th scope="col">Hành Động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="phieugiamgia, status :${lstPgg}" class="text-center">
                    <td th:text="${status.index + 1}"></td>
                    <td th:text="${phieugiamgia.ma}"></td>
                    <td th:text="${phieugiamgia.soLuong}"></td>
                    <td>
                        <span th:if="${phieugiamgia.hinhThucGiam} == true"> Tien mat</span>
                        <span th:if="${phieugiamgia.hinhThucGiam} == false"> %</span>
                    </td>
                    <td th:text="${#numbers.formatDecimal(phieugiamgia.donToiThieu, 0)}"></td>
                    <td>
                        <span th:if="${phieugiamgia.hinhThucGiam == true}" th:text="${#numbers.formatDecimal(phieugiamgia.giaTriGiam, 0)}"></span>
                        <span th:if="${phieugiamgia.hinhThucGiam == false}" th:text="${phieugiamgia.giaTriGiam + ' %'}"></span>
                    </td>
                    <td th:text="${#numbers.formatDecimal(phieugiamgia.giamToiDa, 0)}"></td>
                    <td th:text="${#dates.format(phieugiamgia.ngayBatDau, 'dd/MM/yyyy')}"></td>
                    <td th:text="${#dates.format(phieugiamgia.ngayKetThuc, 'dd/MM/yyyy')}"></td>

                    <td>
                        <label class="switch">
                            <input type="checkbox" id="switchButton_${phieugiamgia.id}" data-id="${phieugiamgia.id}"
                                   data-trang-thai="${phieugiamgia.trangThai}" class="toggle-checkbox"
                                   th:checked="${phieugiamgia.trangThai == 0}"
                                   th:onclick="'confirmToggle(this, ' + ${phieugiamgia.id} + ')'" />
                            <span class="slider round"></span>
                        </label>
                    </td>
                    <td>
                        <a th:href="@{/admin/UpdatePhieuGiamGia/{id}(id=${phieugiamgia.id})}" class="btn btn-outline-success"
                           style="background-color: #28a745">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                 class="bi bi-pencil-square" viewBox="0 0 16 16" style="color: #f0f0f0">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                            </svg>
                        </a>
                    </td>

                </tr>
                </tbody>
            </table>
<!--            <div class="text-left mt-3" style="text-align: left">-->
<!--                <div th:if="${page.number > 0}">-->
<!--                    <a th:href="@{?page=${page.number - 1}&type=${type}&status=${status}}" class="btn btn-primary btn-sm" style="font-weight: bold"><<</a>-->
<!--                </div>-->
<!--                <span class="btn btn-primary btn-sm" th:text="${page.number + 1} + ' / ' + ${page.totalPages}">1 / 1</span>-->
<!--                <div th:if="${page.number + 1 < page.totalPages}">-->
<!--                    <a th:href="@{?page=${page.number + 1}&type=${type}&status=${status}}" class="btn btn-primary btn-sm" style="font-weight: bold">>></a>-->
<!--                </div>-->
<!--            </div>-->

        </div>
    </div>

</div>

<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Template Javascript -->
<script th:src="@{/assets/js/main.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/assets/js/PhieuGiamGia.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function confirmToggle(checkbox, id) {
        Swal.fire({
            title: 'Bạn có chắc chắn?',
            text: "Bạn không thể hoàn tác hành động này!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Vâng, tiếp tục!',
            cancelButtonText: 'Hủy'
        }).then((result) => {
            if (result.isConfirmed) {
                // Call your function to change the status here
                changeStatus(id, checkbox.checked);
                Swal.fire(
                    'Đã xác nhận!',
                    'Trạng thái của phiếu giảm giá đã được thay đổi.',
                    'success'
                );
            } else {
                // Revert the checkbox status
                checkbox.checked = !checkbox.checked;
                Swal.fire(
                    'Đã hủy!',
                    'Hành động của bạn đã bị hủy.',
                    'error'
                );
            }
        });
    }
</script>
<style>
    .table th,
    .table td {
        font-size: 14px;
        vertical-align: middle;
    }

    .table th:first-child,
    .table td:first-child {
        width: 5%;
    }

    .table td {
        white-space: nowrap;
    }

    .table img {
        max-width: 100px;
        height: auto;
        display: block;
        margin: 0 auto;
    }
    .inactive-status {
        background-color: #f8d7da;
        border-radius: 5px;
        padding: 5px 10px;
        color: #721c24;
    }
    .active-status1 {
        background-color: #d4edda;
        border-radius: 5px;
        padding: 5px 10px;
        color: #155724;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ef5151;
        transition: .4s;
        border-radius: 20px;
    }

    .slider.round {
        border-radius: 20px;
    }

    input:checked + .slider {
        background-color: #a7ea7a;
    }

    .slider.round:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider.round:before {
        transform: translateX(20px);
    }
    /* CSS để hiển thị tooltip */
    .switch input[type="checkbox"]:hover {
        cursor: pointer;
    }




</style>
</body>
</html>
